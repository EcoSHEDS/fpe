config$db$host
library(tidyverse)
library(lubridate)
config <- config::get()
config$db$host
config$db$port
config$db$database
config$db$user
?DBI::dbConnect
con <- DBI::dbConnect(DBI::dbDriver("PostgreSQL"), dbname = "fpe")
con <- DBI::dbConnect(DBI::dbDriver("PostgreSQL"), dbname = "floc")
con <- DBI::dbConnect(DBI::dbDriver("PostgreSQL"), dbname = "floc", host = "localhost")
con <- DBI::dbConnect(DBI::dbDriver("PostgreSQL"), dbname = "fpe", host = "localhost")
con <- DBI::dbConnect(
DBI::dbDriver("PostgreSQL"),
host = config$db$host,
port = config$db$port,
dbname = config$db$database,
user = config$db$user,
password = config$db$password
)
con <- DBI::dbConnect(
DBI::dbDriver("PostgreSQL"),
host = config$db$host,
port = config$db$port,
dbname = config$db$database,
user = config$db$user,
password = config$db$password
)
db_stations <- tbl(con, "stations")
db_stations
station_id <- 6
library(tidyverse)
library(lubridate)
config <- config::get()
db_stations <- tbl(con, "stations")
con <- DBI::dbConnect(
DBI::dbDriver("PostgreSQL"),
host = config$db$host,
port = config$db$port,
dbname = config$db$database,
user = config$db$user,
password = config$db$password
)
# browns brook
station_id <- 6
db_datasets <- tbl(con, "datasets")
con <- DBI::dbConnect(
DBI::dbDriver("PostgreSQL"),
host = config$db$host,
port = config$db$port,
dbname = config$db$database,
user = config$db$user,
password = config$db$password
)
library(tidyverse)
library(lubridate)
config <- config::get()
con <- DBI::dbConnect(
DBI::dbDriver("PostgreSQL"),
host = config$db$host,
port = config$db$port,
dbname = config$db$database,
user = config$db$user,
password = config$db$password
)
con <- DBI::dbConnect(
RPostgreSQL::PostgreSQL(),
host = config$db$host,
port = config$db$port,
dbname = config$db$database,
user = config$db$user,
password = config$db$password
)
db_stations <- tbl(con, "stations")
# browns brook
station_id <- 6
db_datasets <- tbl(con, "datasets")
db_datasets
db_datasets <- tbl(con, "datasets") %>%
filter(station_id == !!station_id)
db_datasets
db_datasets <- tbl(con, "datasets") %>%
filter(station_id == !!station_id) %>%
mutate(
config = jsonlite::parse_json(config)
)
db_datasets
db_datasets <- tbl(con, "datasets") %>%
filter(station_id == !!station_id) %>%
mutate(
config = map(config, jsonlite::parse_json)
)
db_datasets
db_datasets <- tbl(con, "datasets") %>%
filter(station_id == !!station_id) %>%
mutate(
config = map(config, jsonlite::fromJSON)
)
db_datasets
db_datasets <- tbl(con, "datasets") %>%
filter(station_id == !!station_id) %>%
mutate(
config = list(map(config, jsonlite::fromJSON))
)
db_datasets
db_datasets$config
db_datasets <- tbl(con, "datasets") %>%
filter(station_id == !!station_id)
db_datasets <- tbl(con, "datasets") %>%
filter(station_id == !!station_id) %>%
select(dataset_id = id)
db_datasets
db_datasets <- tbl(con, "datasets") %>%
filter(station_id == !!station_id) %>%
left_join(tbl(con, "series"), by = c("id" = "dataset_id"))
db_datasets
db_datasets <- tbl(con, "datasets") %>%
filter(station_id == !!station_id) %>%
rename(dataset_id = id) %>%
left_join(tbl(con, "series"), by = c("dataset_id"))
db_datasets
db_series <- tbl(con, "series") %>%
filter(dataset_id == 7)
db_series
db_values <- db_series %>%
select(series_id = id, variable_id) %>%
left_join(tbl(con, "values"), by = "series_id")
db_values
db_values <- db_series %>%
select(series_id = id, variable_id) %>%
left_join(tbl(con, "values"), by = "series_id") %>%
arrange(series_id, timestamp)
db_values$timestamp[[1]]
db_values$timestamp[1]
db_values <- db_series %>%
select(series_id = id, variable_id) %>%
left_join(tbl(con, "values"), by = "series_id") %>%
arrange(series_id, timestamp) %>%
collect()
db_values$timestamp[1]
db_values$timestamp[2]
db_values$timestamp[3]
db_values
db_values <- db_series %>%
select(series_id = id, variable_id) %>%
left_join(tbl(con, "values"), by = "series_id") %>%
arrange(series_id, timestamp) %>%
collect() %>%
mutate(
timestamp = with_tz(timestamp, tzone = "UTC")
)
cat(db_values$timestamp[1])
print(db_values$timestamp[1])
Sys.setenv(TZ='GMT')
print(db_values$timestamp[1])
db_values
Sys.setenv(TZ = "GMT")
library(tidyverse)
library(lubridate)
config <- config::get()
con <- DBI::dbConnect(
RPostgreSQL::PostgreSQL(),
host = config$db$host,
port = config$db$port,
dbname = config$db$database,
user = config$db$user,
password = config$db$password
)
db_stations <- tbl(con, "stations")
# browns brook
station_id <- 6
db_datasets <- tbl(con, "datasets") %>%
filter(station_id == !!station_id)
db_series <- tbl(con, "series") %>%
filter(dataset_id == 7)
db_values <- db_series %>%
select(series_id = id, variable_id) %>%
left_join(tbl(con, "values"), by = "series_id") %>%
arrange(series_id, timestamp) %>%
collect()
print(db_values$timestamp[1])
db_datasets <- tbl(con, "datasets") %>%
filter(station_id == !!station_id)
print(db_values$timestamp[1])
db_imagesets <- tbl(con, "imagesets") %>%
filter(station_id == !!station_id)
db_imagesets
tbl(con, "stations") %>%
select(station_id = id) %>%
filter(station_id == !!station_id)
tbl(con, "stations") %>%
select(station_id = id) %>%
filter(station_id == !!station_id) %>%
left_join(
tbl(con, "datasets") %>%
select(dataset_id = id),
by = "station_id"
)
station_id
tbl(con, "stations") %>%
select(station_id = id) %>%
filter(station_id == !!station_id) %>%
left_join(
tbl(con, "datasets") %>%
select(dataset_id = id),
by = "station_id"
)
tbl(con, "stations") %>%
select(station_id = id) %>%
filter(station_id == !!station_id)
db_values <- tbl(con, "stations") %>%
select(station_id = id) %>%
filter(station_id == !!station_id) %>%
left_join(
tbl(con, "datasets") %>%
select(dataset_id = id, station_id),
by = "station_id"
)
db_values <- tbl(con, "stations") %>%
select(station_id = id) %>%
filter(station_id == !!station_id) %>%
left_join(
tbl(con, "datasets") %>%
select(dataset_id = id, station_id),
by = "station_id"
) %>%
left_join(
tbl(con, "series") %>%
select(series_id = id, dataset_id, variable_id),
by = "dataset_id"
) %>%
left_join(tbl(con, "values"), by = "series_id") %>%
arrange(series_id, timestamp) %>%
collect()
db_values
tbl(con, "images") %>%
head()
db_images <- tbl(con, "stations") %>%
select(station_id = id) %>%
filter(station_id == !!station_id) %>%
left_join(
tbl(con, "imagesets") %>%
select(imageset_id = id, station_id),
by = "station_id"
) %>%
left_join(
tbl(con, "images") %>%
select(id, imageset_id, filename, date, timestamp, width, height, exif, thumb_url),
by = "imageset_id"
) %>%
arrange(timestamp) %>%
collect()
db_images
x <- db_images %>%
head
x$exif[1]
jsonlist::fromJSON(x$exif[1])
jsonlite::fromJSON(x$exif[1])
x <- db_images %>%
head %>%
rowwise() %>%
mutate(
exif = jsonlite::fromJSON(exif)
)
x <- db_images %>%
head %>%
rowwise() %>%
mutate(
exif = list(jsonlite::fromJSON(exif))
)
x
x$exif[[1]]
x
db_images <- tbl(con, "stations") %>%
select(station_id = id) %>%
filter(station_id == !!station_id) %>%
left_join(
tbl(con, "imagesets") %>%
select(imageset_id = id, station_id),
by = "station_id"
) %>%
left_join(
tbl(con, "images") %>%
select(id, imageset_id, filename, date, timestamp, width, height, exif, thumb_url),
by = "imageset_id"
) %>%
arrange(timestamp) %>%
collect() %>%
rowwise() %>%
mutate(
exif = list(jsonlite::fromJSON(exif))
) %>%
ungroup()
db_images
db_images <- tbl(con, "stations") %>%
select(station_id = id) %>%
filter(station_id == !!station_id) %>%
left_join(
tbl(con, "imagesets") %>%
select(imageset_id = id, station_id),
by = "station_id"
) %>%
left_join(
tbl(con, "images") %>%
select(id, imageset_id, filename, date, timestamp, width, height, exif, thumb_url),
by = "imageset_id"
) %>%
arrange(timestamp) %>%
collect() %>%
rowwise() %>%
mutate(
exif = list(jsonlite::fromJSON(exif))
) %>%
ungroup()
db_images$timestamp[1]
